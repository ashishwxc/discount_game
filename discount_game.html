<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Umami & Aroma Rewards</title>

<style>
body{font-family:Arial;background:#fff;text-align:center}
button{padding:14px 22px;font-size:18px;border-radius:10px;border:none;background:#000;color:#fff}
#wheel{font-size:30px;margin:30px}
.stamp{
 width:55px;height:55px;border-radius:50%;
 border:2px dashed gold;margin:5px;
 display:inline-flex;align-items:center;justify-content:center;
}
.filled{
 background:radial-gradient(circle,#ffd700,#b8860b);
 animation:pulse 1s infinite;
}
@keyframes pulse{0%{transform:scale(1)}50%{scale:1.1}100%{scale:1}}
</style>
</head>

<body>

<h2 style="font-size:20px">Umami & Aroma Rewards</h2>

<div id="step1">
<input id="phone" placeholder="Enter Mobile Number">
<br><br>
<button onclick="start()">Continue</button>
</div>

<div id="step2" style="display:none">
<div id="wheel">üé∞</div>
<button id="spinBtn" onclick="spin()">SPIN</button>
<h2 id="result"></h2>

<br>
<a id="wa" target="_blank">
<button>Order on WhatsApp</button>
</a>

<h3>Loyalty Card</h3>
<div id="card"></div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwGs4aNFvnstAb2ZIv2x1wuJN-IFtLwmQ0lWUVmVSUtoGdsUMBgW973QC0UNAgQD_gV/exec";

const COMMON=[
{text:"10% OFF",code:"UA-7B3M9Q"},
{text:"11% OFF",code:"UA-K8F2A6"},
{text:"12% OFF",code:"UA-9Q4L2X"},
{text:"13% OFF",code:"UA-M5A7C8"},
{text:"14% OFF",code:"UA-2XQ9F4"},
{text:"üçπ Free Iced Tea",code:"UA-T9F3KQ"},
{text:"‚òï Free Iced Americano",code:"UA-A7M2QX"}
];

const RARE=[
{text:"16% OFF",code:"UA-F4Q7A9"},
{text:"17% OFF",code:"UA-6C2X8L"},
{text:"18% OFF",code:"UA-Q9M5F2"},
{text:"Buy Burger + Fries",code:"UA-BG7K2"},
{text:"Buy Sandwich + Drink",code:"UA-SD9M3"},
{text:"Buy 2 Beverages Get 1",code:"UA-B21QX"},
{text:"Get Free Fries",code:"UA-FR88Q"}
];

const ULTRA=[{text:"üçù Buy 1 Get 1 Pasta",code:"UA-PB7X2L"}];

let phone="";
let spinning=false;

function start(){
 phone=document.getElementById("phone").value;
 fetch(SCRIPT_URL+"?action=play&phone="+phone)
 .then(r=>r.json())
 .then(d=>{
  if(d.status=="used"){alert("Already played today");return;}
  document.getElementById("step1").style.display="none";
  document.getElementById("step2").style.display="block";
  loadCard();
 });
}

function spin(){
 if(spinning) return;
 spinning=true;
 document.getElementById("spinBtn").disabled=true;

 let r=Math.random()*100;
 let prize;
 if(r<60) prize=COMMON[Math.floor(Math.random()*COMMON.length)];
 else if(r<90) prize=RARE[Math.floor(Math.random()*RARE.length)];
 else prize=ULTRA[0];

 document.getElementById("result").innerHTML=
 prize.text+"<br>"+prize.code;

 if(navigator.vibrate) navigator.vibrate([200,100,200]);

 document.getElementById("wa").href=
 "https://wa.me/c/918130173042?text=My%20coupon%20code%20is%20"+prize.code;

 setInterval(checkStatus,4000);
}

function loadCard(){
 fetch(SCRIPT_URL+"?action=check&phone="+phone)
 .then(r=>r.json())
 .then(d=>drawCard(d.stamps));
}

function checkStatus(){ loadCard(); }

function drawCard(n){
 let c="";
 for(let i=0;i<10;i++){
  c+="<div class='stamp "+(i<n?"filled":"")+"'>‚≠ê</div>";
 }
 document.getElementById("card").innerHTML=c;
}
</script>

</body>
</html>
