<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Umami & Aroma Rewards</title>

<style>
body{
margin:0;
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:linear-gradient(135deg,#1c1c1c,#3a2c1c);
font-family:Arial, sans-serif;
color:#fff;
}

.card{
background:#fff;
color:#000;
padding:40px;
border-radius:20px;
width:95%;
max-width:420px;
text-align:center;
box-shadow:0 10px 40px rgba(0,0,0,.5);
}

h1{margin-top:0;font-size:26px;}

input,button{
width:100%;
padding:14px;
font-size:18px;
border-radius:8px;
border:none;
margin-top:10px;
}

button{
background:#e09f3e;
color:#000;
font-weight:bold;
cursor:pointer;
}

button:disabled{
background:#aaa;
cursor:not-allowed;
}

#slot{
font-size:50px;
margin:25px 0;
min-height:60px;
}

#result{
font-size:26px;
color:green;
font-weight:bold;
}

#code{
font-size:20px;
margin-top:8px;
font-weight:bold;
}

#msg{
margin-top:10px;
color:red;
font-size:14px;
}

.win{
animation:pop .8s ease forwards;
}

@keyframes pop{
0%{transform:scale(.5);opacity:0;}
60%{transform:scale(1.3);opacity:1;}
100%{transform:scale(1);opacity:1;}
}

/* Loyalty Card */

.loyalty{
margin-top:25px;
background:#222;
padding:20px;
border-radius:14px;
}

.stamps{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:12px;
justify-items:center;
}

.stamp{
width:50px;
height:50px;
border-radius:50%;
border:2px dashed #555;
}

.stamp.filled{
background:radial-gradient(circle at 30% 30%,#ffd700,#b8860b);
border:none;
box-shadow:0 0 10px gold;
animation:pop .4s ease;
}

.progress{
margin-top:10px;
font-size:14px;
color:#ddd;
}
</style>
</head>

<body>

<div class="card">

<h1>Umami & Aroma Rewards</h1>

<div id="step1">
<input id="phone" placeholder="Enter Mobile Number" maxlength="10">
<button id="continueBtn" onclick="submitPhone()">Continue</button>
</div>

<div id="step2" style="display:none">

<button id="playBtn" onclick="startGame()">üéÅ Get My Reward</button>

<div id="slot">üé∞</div>
<div id="result"></div>
<div id="code"></div>

<p style="font-size:14px;margin-top:10px">
Do not refresh or leave the screen.<br>
Take a screenshot and share it while placing the order.
</p>

<div class="loyalty">
<h3>Loyalty Card</h3>
<div class="stamps" id="stamps"></div>
<div class="progress" id="progressText"></div>
</div>

</div>

<div id="msg"></div>

</div>

<audio id="sound" src="win-sound.mp3" preload="auto"></audio>

<script>

const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwGs4aNFvnstAb2ZIv2x1wuJN-IFtLwmQ0lWUVmVSUtoGdsUMBgW973QC0UNAgQD_gV/exec";

let phone="";
let locked=false;

/* REWARDS */
const COMMON=[
{t:"10% OFF",c:"UA-7B3M9Q"},
{t:"11% OFF",c:"UA-K8F2A6"},
{t:"12% OFF",c:"UA-9Q4L2X"},
{t:"13% OFF",c:"UA-M5A7C8"},
{t:"14% OFF",c:"UA-2XQ9F4"},
{t:"15% OFF",c:"UA-8L6K3M"},
{t:"üçπ Free Iced Tea",c:"UA-T9F3KQ"},
{t:"‚òï Free Iced Americano",c:"UA-A7M2QX"}
];

const RARE=[
{t:"16% OFF",c:"UA-F4Q7A9"},
{t:"17% OFF",c:"UA-6C2X8L"},
{t:"18% OFF",c:"UA-Q9M5F2"},
{t:"19% OFF",c:"UA-A7L4K6"},
{t:"20% OFF",c:"UA-3F8Q9X"}
];

const ULTRA=[
{t:"üçù Buy 1 Get 1 Free Pasta",c:"UA-PB7X2L"}
];

/* SUBMIT PHONE */

function submitPhone(){
if(locked) return;
phone=document.getElementById("phone").value.trim();
if(phone.length!=10) return alert("Enter valid mobile");

locked=true;
document.getElementById("continueBtn").disabled=true;
document.getElementById("continueBtn").innerText="Checking...";

fetch(SCRIPT_URL,{
method:"POST",
body:new URLSearchParams({phone:phone})
})
.then(r=>r.text())
.then(res=>{
if(res==="ALREADY_USED"){
document.getElementById("msg").innerText="You already played today.";
}else{
document.getElementById("step1").style.display="none";
document.getElementById("step2").style.display="block";
loadStamps(res);
}
})
.catch(()=>alert("Connection error"));
}

/* GAME */

function startGame(){
document.getElementById("playBtn").disabled=true;

let spins=20;
let s=setInterval(()=>{
document.getElementById("slot").innerText=Math.floor(Math.random()*50)+"%";
spins--;
if(spins==0){
clearInterval(s);
showReward();
}
},80);
}

function showReward(){

let roll=Math.random()*100;
let reward;

if(roll<60) reward=randomFrom(COMMON);
else if(roll<90) reward=randomFrom(RARE);
else reward=randomFrom(ULTRA);

document.getElementById("slot").innerText=reward.t;
document.getElementById("result").innerText="üéâ You Won!";
document.getElementById("code").innerText=reward.c;

document.getElementById("sound").play();
}

function randomFrom(arr){
return arr[Math.floor(Math.random()*arr.length)];
}

/* STAMPS */

function loadStamps(count){

count=parseInt(count);
const wrap=document.getElementById("stamps");
wrap.innerHTML="";

for(let i=1;i<=10;i++){
let d=document.createElement("div");
d.className="stamp";
if(i<=count) d.classList.add("filled");
wrap.appendChild(d);
}

document.getElementById("progressText").innerText=
count+" / 10 orders completed";
}

</script>

</body>
</html>
