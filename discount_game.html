<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:black;
color:white;
display:flex;
align-items:center;
justify-content:center;
height:100vh;
}

.container{
text-align:center;
padding:40px;
width:90%;
max-width:420px;
}

input,button{
width:100%;
padding:18px;
font-size:22px;
border-radius:10px;
border:none;
margin-top:12px;
}

button{
background:#ff9800;
color:black;
font-weight:bold;
cursor:pointer;
}

#slot{
font-size:50px;
margin:20px 0;
}

#result{
font-size:28px;
margin-top:15px;
}

#code{
font-size:24px;
color:#00ffea;
margin-top:10px;
}

.notice{
margin-top:15px;
color:#ffd700;
font-size:16px;
}

/* Loyalty */

#loyaltyCard{
margin-top:25px;
padding:20px;
border-radius:14px;
background:#fff3d6;
color:black;
border:2px dashed #ff9800;
}

.stampGrid{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:10px;
margin-top:12px;
}

.stamp{
width:55px;
height:55px;
border-radius:50%;
background:#ddd;
background-size:contain;
background-repeat:no-repeat;
background-position:center;
border:2px solid #bbb;
}

.stamp.filled{
background-image:url("https://github.com/ashishwxc/discount_game/blob/main/logo.png");
background-color:#fff;
border-color:#ff9800;
}

</style>
</head>

<body>

<div class="container">

<div id="step1">
<h2>Enter Mobile Number</h2>
<input id="phone" type="tel" placeholder="10-digit mobile number">
<button onclick="submitPhone()">Continue</button>
</div>

<div id="step2" style="display:none;">
<button onclick="play()">üé∞ Reveal My Reward</button>
<div id="slot">1 2 3</div>
<div id="result"></div>
<div id="code"></div>

<div class="notice">
Do not refresh or leave the screen.<br>
Take a screenshot and share it while placing the order.
</div>

<div id="loyaltyCard">
<b>üí≥ UMAMI & AROMA LOYALTY CARD</b>
<div id="stampText"></div>
<div class="stampGrid" id="stamps"></div>
<div style="margin-top:10px;">Free Dish at 10 Stamps üéÅ</div>
</div>

</div>

</div>

<audio id="winSound" src="win.mp3"></audio>

<script>

const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwGs4aNFvnstAb2ZIv2x1wuJN-IFtLwmQ0lWUVmVSUtoGdsUMBgW973QC0UNAgQD_gV/exec";

const COMMON=[
{text:"10% OFF",code:"UA-7B3M9Q"},
{text:"11% OFF",code:"UA-K8F2A6"},
{text:"12% OFF",code:"UA-9Q4L2X"},
{text:"13% OFF",code:"UA-M5A7C8"},
{text:"14% OFF",code:"UA-2XQ9F4"},
{text:"15% OFF",code:"UA-8L6K3M"},
{text:"üçπ Free Homemade Iced Tea",code:"UA-T9F3KQ"},
{text:"‚òï Free Iced Americano",code:"UA-A7M2QX"}
];

const RARE=[
{text:"16% OFF",code:"UA-F4Q7A9"},
{text:"17% OFF",code:"UA-6C2X8L"},
{text:"18% OFF",code:"UA-Q9M5F2"},
{text:"19% OFF",code:"UA-A7L4K6"},
{text:"20% OFF",code:"UA-3F8Q9X"},
{text:"üçî Buy Any Burger + Fries Free",code:"UA-BF7KQ2"},
{text:"ü•™ Buy Any Sandwich + Drink Free",code:"UA-SD8FQ2"},
{text:"ü•§ Buy 2 Beverages Get 1 Free",code:"UA-B23FQ9"},
{text:"üçü Free Fries",code:"UA-FR5QK2"}
];

const ULTRA=[
{text:"üçù Buy 1 Get 1 Free Pasta",code:"UA-PB7X2L"}
];

function submitPhone(){

const phone=document.getElementById("phone").value;

fetch(SCRIPT_URL+"?phone="+phone+"&device="+getDevice())
.then(r=>r.text())
.then(res=>{

if(res=="ALREADY_USED"){
alert("You have already played today.");
return;
}

document.getElementById("step1").style.display="none";
document.getElementById("step2").style.display="block";

const p=res.split("|");
drawStamps(parseInt(p[1]));

});

}

function play(){

let roll=Math.random()*100;
let prize;

if(roll<60){
 prize=COMMON[Math.floor(Math.random()*COMMON.length)];
}
else if(roll<90){
 prize=RARE[Math.floor(Math.random()*RARE.length)];
}
else{
 prize=ULTRA[Math.floor(Math.random()*ULTRA.length)];
}

let count=0;
const anim=setInterval(()=>{
 document.getElementById("slot").innerText=
 Math.floor(Math.random()*9)+" "+
 Math.floor(Math.random()*9)+" "+
 Math.floor(Math.random()*9);
 count++;
 if(count>15){
  clearInterval(anim);
  document.getElementById("slot").innerText="üéâ üéâ üéâ";
  document.getElementById("result").innerText=prize.text;
  document.getElementById("code").innerText=prize.code;
  document.getElementById("winSound").play();
  confetti({spread:120});
 }
},100);

}

function drawStamps(c){
const box=document.getElementById("stamps");
box.innerHTML="";
document.getElementById("stampText").innerText=c+" / 10 Stamps Collected";
for(let i=1;i<=10;i++){
 const d=document.createElement("div");
 d.className="stamp";
 if(i<=c) d.classList.add("filled");
 box.appendChild(d);
}
}

function getDevice(){
return /android/i.test(navigator.userAgent)?"Android":
/iPhone|iPad|iPod/i.test(navigator.userAgent)?"Apple":"Other";
}

</script>

</body>
</html>
