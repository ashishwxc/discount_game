<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spin & Win</title>

<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#ffecd2,#fcb69f);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
margin:0;
text-align:center;
}

.card{
background:#fff;
padding:25px;
width:360px;
border-radius:16px;
box-shadow:0 10px 30px rgba(0,0,0,.3);
}

.hidden{display:none;}

input,button{
width:100%;
padding:12px;
margin-top:10px;
border-radius:8px;
border:none;
font-size:16px;
}

input{text-align:center;border:1px solid #ccc;}

button{background:#ff7a18;color:#fff;cursor:pointer;}
button:disabled{background:#ccc;}

#slot{font-size:32px;margin:20px 0;}
.pin{background:#000;color:#fff;padding:10px;border-radius:8px;}
.whatsapp{background:#25D366;}
</style>
</head>

<body>

<div class="card">

<!-- STEP 1 -->
<div id="step1">
<h2>Enter Mobile Number</h2>
<input id="mobileInput" placeholder="0501234567">
<button id="continueBtn">Continue</button>
</div>

<!-- STEP 2 -->
<div id="step2" class="hidden">
<h2>ðŸŽ° Spin & Win</h2>
<button id="spinBtn">Spin</button>

<div id="slot">ðŸŽ°</div>
<div id="result"></div>

<div id="pinBox" class="pin hidden"></div>

<button id="waBtn" class="whatsapp hidden">
Order via WhatsApp
</button>
</div>

</div>

<!-- FIREBASE + APP -->
<script type="module">

// ===== FIREBASE IMPORTS =====
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ===== FIREBASE CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyBHlfarr3B28oS-DUW9rxSqSKN3vQJ1Lts",
  authDomain: "discount-1b512.firebaseapp.com",
  projectId: "discount-1b512",
  storageBucket: "discount-1b512.firebasestorage.app",
  messagingSenderId: "697234366614",
  appId: "1:697234366614:web:359ac579df5478dfc8a2b7",
  measurementId: "G-LTVZTLXKTG"
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const db = getFirestore(app);

// ===== COUPONS =====
const COMMON=[
{text:"10% OFF",code:"UA-7B3M9Q"},
{text:"11% OFF",code:"UA-K8F2A6"},
{text:"12% OFF",code:"UA-9Q4L2X"},
{text:"13% OFF",code:"UA-M5A7C8"},
{text:"14% OFF",code:"UA-2XQ9F4"},
{text:"ðŸ¹ Free Iced Tea",code:"UA-T9F3KQ"},
{text:"â˜• Free Iced Americano",code:"UA-A7M2QX"},
{text:"Buy Burger + Fries Free",code:"UA-BG7K2"},
{text:"Buy Sandwich + Drink Free",code:"UA-SD9M3"},
{text:"Buy 2 Beverages Get 1",code:"UA-B21QX"},
{text:"Get Free Fries",code:"UA-FR88Q"}
];

const RARE=[
{text:"16% OFF",code:"UA-F4Q7A9"},
{text:"17% OFF",code:"UA-6C2X8L"},
{text:"18% OFF",code:"UA-Q9M5F2"}
];

const ULTRA=[
{text:"ðŸ Buy 1 Get 1 Pasta",code:"UA-PB7X2L"}
];

const WHATSAPP_LINK="https://wa.me/c/918130173042";

// ===== ELEMENTS =====
const step1=document.getElementById("step1");
const step2=document.getElementById("step2");
const mobileInput=document.getElementById("mobileInput");
const continueBtn=document.getElementById("continueBtn");
const spinBtn=document.getElementById("spinBtn");
const slot=document.getElementById("slot");
const result=document.getElementById("result");
const pinBox=document.getElementById("pinBox");
const waBtn=document.getElementById("waBtn");

let customerMobile="";
let currentPIN="";
let reward=null;

// ===== STEP 1 =====
continueBtn.onclick=()=>{
if(mobileInput.value.length<8){
alert("Enter valid mobile number");
return;
}
customerMobile=mobileInput.value;
step1.classList.add("hidden");
step2.classList.remove("hidden");
};

// ===== SPIN =====
spinBtn.onclick=()=>{
spinBtn.disabled=true;

let spins=15;
let timer=setInterval(()=>{
slot.innerText=COMMON[Math.floor(Math.random()*COMMON.length)].text;
spins--;
if(spins===0){
clearInterval(timer);
showWin();
}
},100);
};

function pickReward(){
let r=Math.random();
if(r<0.7) return COMMON[Math.floor(Math.random()*COMMON.length)];
if(r<0.95) return RARE[Math.floor(Math.random()*RARE.length)];
return ULTRA[Math.floor(Math.random()*ULTRA.length)];
}

// ===== SHOW WIN =====
async function showWin(){
reward=pickReward();
result.innerText=`YOU WON: ${reward.text}\nCODE: ${reward.code}`;

currentPIN=Math.floor(100000+Math.random()*900000).toString();

pinBox.innerText="ORDER PIN: "+currentPIN;
pinBox.classList.remove("hidden");

waBtn.classList.remove("hidden");

// Save order to Firestore
await setDoc(doc(db,"orders",currentPIN),{
pin:currentPIN,
mobile:customerMobile,
reward:reward.text,
code:reward.code,
used:false,
created:Date.now()
});

waBtn.onclick=()=>{
window.open(
WHATSAPP_LINK+
"?text="+encodeURIComponent(
"Order Request\nReward: "+reward.text+
"\nCode: "+reward.code+
"\nPIN: "+currentPIN+
"\nMobile: "+customerMobile
)
);
};
}

</script>

</body>
</html>
