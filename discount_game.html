<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Umami & Aroma Rewards</title>

<style>
body{
margin:0;
background:#f5f5f5;
color:#111;
font-family:Arial;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
overflow:hidden;
}

.box{
width:95%;
max-width:480px;
background:#ffffff;
padding:30px;
border-radius:20px;
text-align:center;
box-shadow:0 8px 30px rgba(0,0,0,.15);
position:relative;
z-index:2;
}

h1{font-size:28px;color:#222;}

input,button{
width:100%;
padding:15px;
font-size:18px;
border-radius:10px;
border:1px solid #ccc;
margin-top:12px;
}

button{
background:#d4af37;
color:#000;
font-weight:bold;
border:none;
}

button:disabled{background:#999}

#slot{font-size:48px;margin:20px 0;}
#result{font-size:26px;color:#00875a;}
#code{font-size:20px;margin-top:10px;}

.note{
font-size:14px;
color:#555;
margin-top:15px;
}

.stamps{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:10px;
margin-top:15px;
}

.stamp{
height:55px;
border:2px dashed #d4af37;
border-radius:8px;
background:#fafafa;
}

.stamp.filled{
background:radial-gradient(circle,#ffd700,#b8860b);
}

/* CONFETTI */
.confetti{
position:fixed;
width:8px;
height:8px;
background:red;
top:-10px;
animation:fall 3s linear infinite;
z-index:1;
}

@keyframes fall{
0%{transform:translateY(-10px) rotate(0deg);}
100%{transform:translateY(110vh) rotate(360deg);}
}
</style>
</head>

<body>

<div class="box">

<!-- PHONE SCREEN -->
<div id="phoneScreen">
<h1>Umami & Aroma Rewards</h1>
<input id="phone" placeholder="Enter Mobile Number">
<button id="startBtn" onclick="start()">Continue</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" style="display:none">

<div id="slot">üé∞</div>

<button id="spinBtn" onclick="spin()">Spin</button>

<div id="result"></div>
<div id="code"></div>

<a id="waBtn" href="https://wa.me/c/918130173042" target="_blank" style="display:none;">
<button style="background:#25D366;color:#000;margin-top:12px;">
Place Order on WhatsApp
</button>
</a>

<div class="note">
Do not refresh or leave the screen.<br>
Take screenshot & show at counter.
</div>

<h3>Loyalty Card</h3>
<div class="stamps" id="stamps"></div>

</div>

</div>

<audio id="winSound" src="win-sound.mp3"></audio>

<script>

const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwGs4aNFvnstAb2ZIv2x1wuJN-IFtLwmQ0lWUVmVSUtoGdsUMBgW973QC0UNAgQD_gV/exec";

/* -------- PRIZES -------- */

const COMMON=[
{text:"10% OFF",code:"UA-7B3M9Q"},
{text:"11% OFF",code:"UA-K8F2A6"},
{text:"12% OFF",code:"UA-9Q4L2X"},
{text:"13% OFF",code:"UA-M5A7C8"},
{text:"14% OFF",code:"UA-2XQ9F4"},
{text:"üçπ Free Iced Tea",code:"UA-T9F3KQ"},
{text:"‚òï Free Iced Americano",code:"UA-A7M2QX"},
{text:"Buy Burger + Fries Free",code:"UA-BG7K2"},
{text:"Buy Sandwich + Drink Free",code:"UA-SD9M3"},
{text:"Buy 2 Beverages Get 1",code:"UA-B21QX"},
{text:"Get Free Fries",code:"UA-FR88Q"}
];

const RARE=[
{text:"16% OFF",code:"UA-F4Q7A9"},
{text:"17% OFF",code:"UA-6C2X8L"},
{text:"18% OFF",code:"UA-Q9M5F2"},
{text:"Buy Burger + Fries Free",code:"UA-BG7K2"},
{text:"Buy Sandwich + Drink Free",code:"UA-SD9M3"},
{text:"Buy 2 Beverages Get 1",code:"UA-B21QX"},
{text:"Get Free Fries",code:"UA-FR88Q"}
];

const ULTRA=[
{text:"üçù Buy 1 Get 1 Pasta",code:"UA-PB7X2L"}
];

let phone="";
let confettiInterval;

/* -------- START -------- */

function start(){

 phone=document.getElementById("phone").value.trim();
 if(phone.length<8){alert("Enter valid number");return;}

 const btn=document.getElementById("startBtn");
 btn.disabled=true;
 btn.innerText="Checking...";

 fetch(`${SCRIPT_URL}?action=spin&phone=${phone}`)
 .then(r=>r.text())
 .then(res=>{
   if(res==="ALREADY_PLAYED"){
     alert("Already used today.");
     btn.disabled=false;
     btn.innerText="Continue";
     return;
   }

   document.getElementById("phoneScreen").style.display="none";
   document.getElementById("gameScreen").style.display="block";
   loadLoyalty();
 });
}

/* -------- SPIN -------- */

function spin(){

 const spinBtn=document.getElementById("spinBtn");
 spinBtn.disabled=true;

 let prize=pickPrize();

 document.getElementById("slot").innerText="üéâ";
 document.getElementById("result").innerText=prize.text;
 document.getElementById("code").innerText="Code: "+prize.code;

 document.getElementById("winSound").play();
 document.getElementById("waBtn").style.display="block";

 startConfetti();
}

/* -------- PRIZE PICK -------- */

function pickPrize(){
 let r=Math.random()*100;
 if(r<60) return COMMON[Math.floor(Math.random()*COMMON.length)];
 if(r<90) return RARE[Math.floor(Math.random()*RARE.length)];
 return ULTRA[Math.floor(Math.random()*ULTRA.length)];
}

/* -------- LOYALTY -------- */

function loadLoyalty(){
 fetch(`${SCRIPT_URL}?action=getLoyalty&phone=${phone}`)
 .then(r=>r.text())
 .then(c=>{
   const s=document.getElementById("stamps");
   s.innerHTML="";
   for(let i=0;i<10;i++){
     const d=document.createElement("div");
     d.className="stamp"+(i<Number(c)?" filled":"");
     s.appendChild(d);
   }
 });
}

/* -------- CONFETTI -------- */

function startConfetti(){

 if(confettiInterval) return;

 confettiInterval=setInterval(()=>{
   const c=document.createElement("div");
   c.className="confetti";
   c.style.left=Math.random()*100+"vw";
   c.style.backgroundColor=
     ["red","gold","green","blue","purple"]
     [Math.floor(Math.random()*5)];
   document.body.appendChild(c);

   setTimeout(()=>c.remove(),3000);
 },120);
}

</script>

</body>
</html>
